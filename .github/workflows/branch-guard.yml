# .github/workflows/branch-guard.yml
#
# Copyright Â© 2025 Network Pro Strategies (Network Proâ„¢)
# SPDX-License-Identifier: CC-BY-4.0 OR GPL-3.0-or-later
# This file is part of Network Pro
#
# Warns if commits are pushed directly to master/main instead of via PR.
# Does NOT block the commit â€” it just posts a workflow summary and log warning.

name: Branch Guard

on:
  push:
    branches:
      - master
      - main

permissions:
  contents: read

jobs:
  warn-direct-commit:
    runs-on: ubuntu-24.04
    steps:
      - name: Check commit source
        run: |
          # Only trigger warning if commit wasn't from a merge or bot
          if [[ "${{ github.event.head_commit.message }}" != *"Merge pull request"* ]] && \
             [[ "${{ github.actor }}" != "dependabot[bot]" ]]; then
            echo "::warning ::âš ï¸ Direct commit to ${GITHUB_REF##*/} by $GITHUB_ACTOR."
            echo "### âš ï¸ Direct Commit Detected" >> $GITHUB_STEP_SUMMARY
            echo "A commit was pushed directly to \`${GITHUB_REF##*/}\` by **${GITHUB_ACTOR}**." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ’¡ It's recommended to use pull requests for traceability and CI validation." >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… Merge or bot commit detected â€” no action needed."
          fi
